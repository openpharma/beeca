<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Main variance estimation function. Estimates the variance-covariance
matrix of a marginal estimand for a generalized linear model (GLM) object
using specified methods. This function supports both Ge's and Ye's methods
for variance estimation, accommodating different estimand specifications."><title>Estimate variance-covariance matrix for marginal estimand based on GLM model — estimate_varcov • beeca</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate variance-covariance matrix for marginal estimand based on GLM model — estimate_varcov"><meta property="og:description" content="Main variance estimation function. Estimates the variance-covariance
matrix of a marginal estimand for a generalized linear model (GLM) object
using specified methods. This function supports both Ge's and Ye's methods
for variance estimation, accommodating different estimand specifications."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">beeca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/estimand_and_implementations.html">Introduction to estimating a marginal estimand with beeca</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/beeca/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate variance-covariance matrix for marginal estimand based on GLM model</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/beeca/blob/HEAD/R/estimate_varcov.R" class="external-link"><code>R/estimate_varcov.R</code></a></small>
      <div class="d-none name"><code>estimate_varcov.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Main variance estimation function. Estimates the variance-covariance
matrix of a marginal estimand for a generalized linear model (GLM) object
using specified methods. This function supports both Ge's and Ye's methods
for variance estimation, accommodating different estimand specifications.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_varcov</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ge"</span>, <span class="st">"Ye"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HC0"</span>, <span class="st">"model-based"</span>, <span class="st">"HC3"</span>, <span class="st">"HC"</span>, <span class="st">"HC1"</span>, <span class="st">"HC2"</span>, <span class="st">"HC4"</span>, <span class="st">"HC4m"</span>, <span class="st">"HC5"</span><span class="op">)</span>,</span>
<span>  mod <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>a fitted <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code> object augmented with
<code>counterfactual.predictions</code>, <code>counterfactual.predictions</code> and <code>counterfactual.means</code></p></dd>


<dt>strata</dt>
<dd><p>an optional string or vector of strings specifying the names
of stratification variables. Relevant only for Ye's method and used to
adjust the variance-covariance estimation for stratification.
If provided, each specified variable must be present in the model.</p></dd>


<dt>method</dt>
<dd><p>a string indicating the chosen method for variance estimation.
Supported methods are <code>Ge</code> and <code>Ye</code>. The default method is <code>Ge</code> based on Ge
et al (2011) which is suitable for the variance estimation of conditional
average treatment effect. The method <code>Ye</code> is based on Ye et al (2023) and is
suitable for the variance estimation of population average treatment effect.
For more details, see <a href="https://osf.io/9mp58/" class="external-link">Magirr et al. (2024)</a>.</p></dd>


<dt>type</dt>
<dd><p>a string indicating the type of
variance estimator to use (only applicable for Ge's method). Supported types include HC0 (default),
model-based, HC3, HC, HC1, HC2, HC4, HC4m, and HC5. See <a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a> for heteroscedasticity-consistent estimators.
This parameter allows for flexibility in handling heteroscedasticity
and model specification errors.</p></dd>


<dt>mod</dt>
<dd><p>For Ye's method, the implementation of open-source RobinCar package
has an additional variance decomposition step when estimating the robust variance,
which then utilizes different counterfactual outcomes than the original reference.
Set <code>mod = TRUE</code> to use exactly the implementation method described in
Ye et al (2022), default to <code>FALSE</code> to use the modified implementation in
RobinCar and Bannick et al (2023) which improves stability.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an updated <code>glm</code> object appended with an
additional component <code>robust_varcov</code>, which is the estimated variance-covariance matrix
of the marginal effect. The matrix format and estimation method are
indicated in the matrix attributes.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>estimate_varcov</code> function facilitates robust variance estimation
techniques for GLM models, particularly useful in clinical trial analysis
and other fields requiring robust statistical inference. It allows
researchers to account for complex study designs,
including stratification and different treatment contrasts,
by providing a flexible interface for variance-covariance estimation.</p>
<p>Note: Ensure that the <code>glm</code> object has been adequately prepared with
<code><a href="predict_counterfactuals.html">predict_counterfactuals</a></code> and <code><a href="average_predictions.html">average_predictions</a></code>
before applying <code>estimate_varcov()</code>. Failure to do so may result in
errors indicating missing components.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ye T. et al. (2023) Robust variance
estimation for covariate-adjusted unconditional treatment effect in randomized
clinical trials with binary outcomes. Statistical Theory and Related Fields</p>
<p>Ge M. et al. (2011) Covariate-Adjusted
Difference in Proportions from Clinical Trials Using Logistic Regression
and Weighted Risk Differences. Drug Information Journal.</p>
<p>Bannick, M. S., et al. A General Form of Covariate Adjustment in
Randomized Clinical Trials. arXiv preprint arXiv:2306.10213 (2023).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="average_predictions.html">average_predictions()</a></code> for averaging counterfactual
predictions.</p>
<p><code><a href="apply_contrast.html">apply_contrast()</a></code> for computing a summary measure.</p>
<p><code><a href="get_marginal_effect.html">get_marginal_effect()</a></code> for estimating marginal effects directly
from an original <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code> object</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example usage with a binary outcome GLM model</span></span></span>
<span class="r-in"><span><span class="va">trial01</span><span class="op">$</span><span class="va">trtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trial01</span><span class="op">$</span><span class="va">trtp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">aval</span> <span class="op">~</span> <span class="va">trtp</span> <span class="op">+</span> <span class="va">bl_cov</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">trial01</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#' # Preprocess fit1 as required by estimate_varcov</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="va">fit1</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="predict_counterfactuals.html">predict_counterfactuals</a></span><span class="op">(</span>trt <span class="op">=</span> <span class="st">"trtp"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="average_predictions.html">average_predictions</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There is 1 record omitted from the original data due to missing values, please check if they should be imputed prior to model fitting.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate variance-covariance using Ge's method</span></span></span>
<span class="r-in"><span><span class="va">fit3_ge</span> <span class="op">&lt;-</span> <span class="fu">estimate_varcov</span><span class="op">(</span><span class="va">fit2</span>, method <span class="op">=</span> <span class="st">"Ge"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit3_ge</span><span class="op">$</span><span class="va">robust_varcov</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               0             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0  1.878839e-03 -2.759138e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -2.759138e-06  1.808457e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"type")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Ge - HC0"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimate variance-covariance using Ye's method with stratification</span></span></span>
<span class="r-in"><span><span class="va">fit4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">aval</span> <span class="op">~</span> <span class="va">trtp</span> <span class="op">+</span> <span class="va">bl_cov_c</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">trial01</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="predict_counterfactuals.html">predict_counterfactuals</a></span><span class="op">(</span>trt <span class="op">=</span> <span class="st">"trtp"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="average_predictions.html">average_predictions</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There are 2 records omitted from the original data due to missing values, please check if they should be imputed prior to model fitting.</span>
<span class="r-in"><span><span class="va">fit4_ye</span> <span class="op">&lt;-</span> <span class="fu">estimate_varcov</span><span class="op">(</span><span class="va">fit4</span>, method <span class="op">=</span> <span class="st">"Ye"</span>, strata <span class="op">=</span> <span class="st">"bl_cov_c"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit4_ye</span><span class="op">$</span><span class="va">robust_varcov</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               0             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0  1.890549e-03 -3.739455e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -3.739455e-07  1.846667e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"type")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Ye"</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alex Przybylski, Mark Baillie, Craig Wang, Dominic Magirr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

