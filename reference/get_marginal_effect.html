<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimates the marginal treatment effect from a logistic regression working model
using a specified choice of variance estimator and contrast."><title>Estimate marginal treatment effects using a GLM working model — get_marginal_effect • beeca</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate marginal treatment effects using a GLM working model — get_marginal_effect"><meta property="og:description" content="Estimates the marginal treatment effect from a logistic regression working model
using a specified choice of variance estimator and contrast."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">beeca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/estimand_and_implementations.html">Introduction to estimating a marginal estimand with beeca</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate marginal treatment effects using a GLM working model</h1>
      
      <div class="d-none name"><code>get_marginal_effect.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates the marginal treatment effect from a logistic regression working model
using a specified choice of variance estimator and contrast.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_marginal_effect</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">trt</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"Ge"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"HC0"</span>,</span>
<span>  contrast <span class="op">=</span> <span class="st">"diff"</span>,</span>
<span>  <span class="va">reference</span>,</span>
<span>  mod <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>a fitted <a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a> object.</p></dd>


<dt>trt</dt>
<dd><p>a string specifying the name of the treatment variable
in the model formula. It must be one of the linear predictor variables used
in fitting the <code>object</code>.</p></dd>


<dt>strata</dt>
<dd><p>an optional string or vector of strings specifying the names
of stratification variables. Relevant only for Ye's method and used to
adjust the variance-covariance estimation for stratification.
If provided, each specified variable must be present in the model.</p></dd>


<dt>method</dt>
<dd><p>a string indicating the chosen method for variance estimation.
Supported methods are <code>Ge</code> and <code>Ye</code>. The default method is <code>Ge</code> based on Ge
et al (2011) which is suitable for the variance estimation of conditional
average treatment effect. The method <code>Ye</code> is based on Ye et al (2023) and is
suitable for the variance estimation of population average treatment effect.
For more details, see <a href="https://osf.io/9mp58/" class="external-link">Magirr et al. (2024)</a>.</p></dd>


<dt>type</dt>
<dd><p>a string indicating the type of
variance estimator to use (only applicable for Ge's method). Supported types include HC0 (default),
model-based, HC3, HC, HC1, HC2, HC4, HC4m, and HC5. See <a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a> for heteroscedasticity-consistent estimators.</p></dd>


<dt>contrast</dt>
<dd><p>a string indicating choice of contrast. Defaults to 'diff' for a risk difference. See <a href="apply_contrast.html">apply_contrast</a>.</p></dd>


<dt>reference</dt>
<dd><p>a string indicating which treatment group should be considered as
the reference level. Accepted values are one of the levels in the treatment
variable. Default to the first level used in the <code>glm</code> object. This parameter influences the calculation of treatment effects
relative to the chosen reference group.</p></dd>


<dt>mod</dt>
<dd><p>for Ye's method, the implementation of open-source RobinCar package
has an additional variance decomposition step when estimating the robust variance,
which then utilizes different counterfactual outcomes than the original reference.
Set <code>mod = TRUE</code> to use exactly the implementation method described in
Ye et al (2022), default to <code>FALSE</code> to use the modified implementation in
RobinCar and Bannick et al (2023) which improves stability.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an updated <code>glm</code> object appended with marginal estimate components:
counterfactual.predictions (see <a href="predict_counterfactuals.html">predict_counterfactuals</a>),
counterfactual.means (see <a href="average_predictions.html">average_predictions</a>),
robust_varcov (see <a href="estimate_varcov.html">estimate_varcov</a>),
marginal_est, marginal_se (see <a href="apply_contrast.html">apply_contrast</a>) and marginal_results. A summary is shown below</p><table class="table table"><tr><td>counterfactual.predictions</td><td>Counterfactual predictions based on the working model. For each subject in the input glm data, the potential outcomes are obtained by assigning subjects to each of the possible treatment variable levels. Each prediction is associated with a descriptive label explaining the counterfactual scenario.</td></tr><tr><td>counterfactual.means</td><td>Average of the counterfactual predictions for each level of the treatment variable.</td></tr><tr><td>robust_varcov</td><td>Variance-covariance matrix of the marginal effect estimate for each level of treatment variable, with estimation method indicated in the attributes.</td></tr><tr><td>marginal_est</td><td>Marginal treatment effect estimate for a given contrast.</td></tr><tr><td>marginal_se</td><td>Standard error estimate of the marginal treatment effect estimate.</td></tr><tr><td>marginal_results</td><td>Analysis results data (ARD) containing a summary of the analysis for subsequent reporting.</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>get_marginal_effect</code> function is a wrapper that facilitates
advanced variance estimation techniques for GLM models with covariate adjustment
targeting a population average treatment effect. It is particularly useful in clinical trial analysis
and other fields requiring robust statistical inference.
It allows researchers to account for complex study designs,
including stratification and treatment contrasts, by providing a flexible
interface for variance-covariance estimation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">trial01</span><span class="op">$</span><span class="va">trtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trial01</span><span class="op">$</span><span class="va">trtp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">aval</span> <span class="op">~</span> <span class="va">trtp</span> <span class="op">+</span> <span class="va">bl_cov</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">trial01</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">get_marginal_effect</span><span class="op">(</span>trt <span class="op">=</span> <span class="st">"trtp"</span>, method <span class="op">=</span> <span class="st">"Ye"</span>, contrast <span class="op">=</span> <span class="st">"diff"</span>, reference <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There is 1 record omitted from the original data due to missing values, please check if they should be imputed prior to model fitting.</span>
<span class="r-in"><span><span class="va">fit1</span><span class="op">$</span><span class="va">marginal_results</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    TRTVAR TRTVAL    PARAM ANALTYP1    STAT     STATVAL ANALMETH      ANALDESC   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> trtp   1         aval  DESCRIPTIVE N       134      count         Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> trtp   1         aval  DESCRIPTIVE n        56      count         Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> trtp   1         aval  DESCRIPTIVE %        41.8    percentage    Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> trtp   1         aval  INFERENTIAL risk      0.419  g-computation Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> trtp   1         aval  INFERENTIAL risk_se   0.042<span style="text-decoration: underline;">7</span> Ye            Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> trtp   0         aval  DESCRIPTIVE N       133      count         Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> trtp   0         aval  DESCRIPTIVE n        65      count         Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> trtp   0         aval  DESCRIPTIVE %        48.9    percentage    Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> trtp   0         aval  INFERENTIAL risk      0.487  g-computation Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> trtp   0         aval  INFERENTIAL risk_se   0.043<span style="text-decoration: underline;">5</span> Ye            Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> trtp   diff: 1-0 aval  INFERENTIAL diff     -<span style="color: #BB0000;">0.068</span><span style="color: #BB0000; text-decoration: underline;">4</span> g-computation Computed u…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> trtp   diff: 1-0 aval  INFERENTIAL diff_se   0.060<span style="text-decoration: underline;">9</span> Ye            Computed u…</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alex Przybylski, Mark Baillie, Craig Wang, Dominic Magirr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

