<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Predict counterfactual outcomes in GLM models — predict_counterfactuals • beeca</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predict counterfactual outcomes in GLM models — predict_counterfactuals"><meta name="description" content="This function calculates counterfactual predictions for each level of a
specified treatment variable in a generalized linear model (GLM).
It is designed to aid in the assessment of treatment effects by predicting
outcomes under different treatments under causal inference framework."><meta property="og:description" content="This function calculates counterfactual predictions for each level of a
specified treatment variable in a generalized linear model (GLM).
It is designed to aid in the assessment of treatment effects by predicting
outcomes under different treatments under causal inference framework."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">beeca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimand_and_implementations.html">Introduction to estimating a marginal estimand with beeca</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/beeca/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Predict counterfactual outcomes in GLM models</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/beeca/blob/v0.2.0/R/predict_counterfactuals.R" class="external-link"><code>R/predict_counterfactuals.R</code></a></small>
      <div class="d-none name"><code>predict_counterfactuals.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates counterfactual predictions for each level of a
specified treatment variable in a generalized linear model (GLM).
It is designed to aid in the assessment of treatment effects by predicting
outcomes under different treatments under causal inference framework.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predict_counterfactuals</span><span class="op">(</span><span class="va">object</span>, <span class="va">trt</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a fitted <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code> object for which
counterfactual predictions are desired.</p></dd>


<dt id="arg-trt">trt<a class="anchor" aria-label="anchor" href="#arg-trt"></a></dt>
<dd><p>a string specifying the name of the treatment variable
in the model formula. It must be one of the linear predictor variables used
in fitting the <code>object</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an updated <code>glm</code> object appended with an
additional component <code>counterfactual.predictions</code>.</p>
<p>This component contains a tibble with columns representing counterfactual
predictions for each level of the treatment variable. A descriptive <code>label</code>
attribute explains the counterfactual scenario associated with each column.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function works by creating new datasets from the original data used
to fit the GLM model. In these datasets, the treatment variable for all
records (e.g., patients) is set to each possible treatment level.</p>
<p>Predictions are then made for each dataset based on the fitted GLM model,
simulating the response variable under each treatment condition.</p>
<p>The results are stored in a tidy format and appended to the original model
object for further analysis or inspection.</p>
<p>For averaging counterfactual outcomes, apply <code><a href="average_predictions.html">average_predictions()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="average_predictions.html">average_predictions()</a></code> for averaging counterfactual
predictions.</p>
<p><code><a href="get_marginal_effect.html">get_marginal_effect()</a></code> for estimating marginal effects directly
from an original <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code> object</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Preparing data and fitting a GLM model</span></span></span>
<span class="r-in"><span><span class="va">trial01</span><span class="op">$</span><span class="va">trtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trial01</span><span class="op">$</span><span class="va">trtp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">aval</span> <span class="op">~</span> <span class="va">trtp</span> <span class="op">+</span> <span class="va">bl_cov</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">trial01</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generating counterfactual predictions</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">predict_counterfactuals</span><span class="op">(</span><span class="va">fit1</span>, <span class="st">"trtp"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There is 1 record omitted from the original data due to missing values, please check if they should be imputed prior to model fitting.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Accessing the counterfactual predictions</span></span></span>
<span class="r-in"><span><span class="va">fit2</span><span class="op">$</span><span class="va">counterfactual.predictions</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 267 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      `0`   `1`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 0.533 0.463</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 0.537 0.468</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 0.481 0.413</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 0.510 0.441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 0.428 0.362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 0.474 0.406</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 0.490 0.421</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 0.496 0.427</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 0.514 0.445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 0.490 0.422</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 257 more rows</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">counterfactual.predictions</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $class</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "tbl_df"     "tbl"        "data.frame"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $row.names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [109] 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [127] 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [145] 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [163] 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [181] 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [199] 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [217] 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [235] 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [253] 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0" "1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                           0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "Counterfactual predictions setting trtp=0 for all records" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                           1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "Counterfactual predictions setting trtp=1 for all records" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $treatment.variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "trtp"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alex Przybylski, Mark Baillie, Craig Wang, Dominic Magirr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

